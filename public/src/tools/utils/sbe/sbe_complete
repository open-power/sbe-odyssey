#!/bin/sh
# IBM_PROLOG_BEGIN_TAG
# This is an automatically generated prolog.
#
# $Source: public/src/tools/utils/sbe/sbe_complete $
#
# OpenPOWER sbe Project
#
# Contributors Listed Below - COPYRIGHT 2022,2023
# [+] International Business Machines Corp.
#
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
# implied. See the License for the specific language governing
# permissions and limitations under the License.
#
# IBM_PROLOG_END_TAG

./sbe gen_list || exit -1

sbe_complete(){
    local cur prev opts opts_workon
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    # sbe script will output these files always
    opts_help="$(cat ${HOME}/.sbe/cmd_list.dat)"
    opts_cmd="${opts_help} help"
    opts_workon="$(cat ${HOME}/.sbe/plat_list.dat)"

    if [[ ${prev} == ./sbe ]] ; then
        COMPREPLY=( $(compgen -W "${opts_cmd}" -- ${cur}) )
        return 0
    fi

    if [[ ${prev} == workon ]] ; then
        COMPREPLY=( $(compgen -W "${opts_workon}" -- ${cur}) )
        return 0
    fi

    if [[ ${prev} == runsimics ]] ; then
        COMPREPLY=( $(compgen -W "till_boot" -- ${cur}) )
        return 0
    fi

    if [[ ${prev} == execute ]] ; then
        COMPREPLY=( $(compgen -W "till_boot" -- ${cur}) )
        return 0
    fi

    if [[ ${prev} == help ]] ; then
        COMPREPLY=( $(compgen -W "${opts_help}" -- ${cur}) )
        return 0
    fi
}

complete -F sbe_complete sbe || exit -1

echo "enabled auto complete"